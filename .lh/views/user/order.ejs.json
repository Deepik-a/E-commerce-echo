{
    "sourceFile": "views/user/order.ejs",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1736676476621,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1736676485632,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -333,9 +333,9 @@\n             document.getElementById('shippingAddress').textContent = order.address;\r\n     \r\n \r\n             document.getElementById('paymentMethod').textContent = order.paymentMethod;\r\n-            document.getElementById('couponApplied').textContent = `₹Rs order.couponDiscount}`\r\n+            document.getElementById('couponApplied').textContent = `₹Rs` order.couponDiscount`\r\n            document.getElementById('totalPrice').textContent = order.payableAmount.toLocaleString();\r\n \r\n             // Clear existing items\r\n             const itemsTable = document.getElementById('itemsPurchased');\r\n"
                },
                {
                    "date": 1736676494536,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -333,9 +333,9 @@\n             document.getElementById('shippingAddress').textContent = order.address;\r\n     \r\n \r\n             document.getElementById('paymentMethod').textContent = order.paymentMethod;\r\n-            document.getElementById('couponApplied').textContent = `₹Rs` order.couponDiscount\r\n+            document.getElementById('couponApplied').textContent =  order.couponDiscount\r\n            document.getElementById('totalPrice').textContent = order.payableAmount.toLocaleString();\r\n \r\n             // Clear existing items\r\n             const itemsTable = document.getElementById('itemsPurchased');\r\n"
                },
                {
                    "date": 1736676502947,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -333,9 +333,9 @@\n             document.getElementById('shippingAddress').textContent = order.address;\r\n     \r\n \r\n             document.getElementById('paymentMethod').textContent = order.paymentMethod;\r\n-            document.getElementById('couponApplied').textContent = \"\" order.couponDiscount\r\n+            document.getElementById('couponApplied').textContent = \"R\" order.couponDiscount\r\n            document.getElementById('totalPrice').textContent = order.payableAmount.toLocaleString();\r\n \r\n             // Clear existing items\r\n             const itemsTable = document.getElementById('itemsPurchased');\r\n"
                }
            ],
            "date": 1736676476621,
            "name": "Commit-0",
            "content": "<%- include('navbar') %>\r\n\r\n<!-- jQuery -->\r\n<script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\r\n\r\n<!-- Bootstrap JS -->\r\n<script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\r\n\r\n<!--breadcrumbs-->\r\n\r\n<div class=\"container mx-auto mt-8 px-4\">\r\n  <nav class=\"flex\" aria-label=\"Breadcrumb\">\r\n  <ol class=\"inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse\">\r\n    <li class=\"inline-flex items-center\">\r\n      <a href=\"/\" class=\"inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600 dark:text-gray-400 dark:hover:text-white\">\r\n        <svg class=\"w-3 h-3 me-2.5\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\r\n          <path d=\"m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z\"/>\r\n        </svg>\r\n        Home\r\n      </a>\r\n    </li>\r\n    <li>\r\n      <div class=\"flex items-center\">\r\n        <svg class=\"rtl:rotate-180 w-3 h-3 text-gray-400 mx-1\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 6 10\">\r\n          <path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"m1 9 4-4-4-4\"/>\r\n        </svg>\r\n        <a href=\"/userprofile\" class=\"ms-1 text-sm font-medium text-gray-700 hover:text-blue-600 md:ms-2 dark:text-gray-400 dark:hover:text-white\">Profile</a>\r\n      </div>\r\n    </li>\r\n    <li aria-current=\"page\">\r\n      <div class=\"flex items-center\">\r\n        <svg class=\"rtl:rotate-180 w-3 h-3 text-gray-400 mx-1\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 6 10\">\r\n          <path stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"m1 9 4-4-4-4\"/>\r\n        </svg>\r\n        <span class=\"ms-1 text-sm font-medium text-gray-500 md:ms-2 dark:text-gray-400\">Orders</span>\r\n      </div>\r\n    </li>\r\n  </ol>\r\n</nav>\r\n\r\n  <div class=\"flex justify-center\">\r\n      <div class=\"w-full max-w-4xl\">\r\n          <!-- Order Card -->\r\n          <% orderDetails.forEach(order => { %>\r\n            <% if (order && order._id) { %>\r\n              <div class=\"mb-6 overflow-hidden bg-white rounded-lg shadow-md border border-gray-100\">\r\n                <% order.items.forEach(item => { %>\r\n                  <% if (item && item.productId && item.productId._id) { %>  <!-- Check if item and its properties are valid -->\r\n                    <div class=\"flex flex-col md:flex-row p-6 gap-6\">\r\n                      <button onclick=\"viewOrder('<%= order._id %>')\">\r\n                 \r\n                        <img src=\"/uploads/<%= item.productImage %>\" \r\n                             class=\"w-full md:w-48 h-48 object-cover rounded-lg\">\r\n                      </button>\r\n                        <div class=\"flex-1 space-y-4\">\r\n                          <div class=\"flex justify-between items-start\">\r\n                              <h5 class=\"text-xl font-semibold text-gray-900\">\r\n                                  <%=item.productId.name%>\r\n                              </h5>\r\n                              <p class=\"text-lg font-bold text-gray-900\">\r\n                                <i class=\"fa-solid fa-indian-rupee-sign\"></i><%= item.productPrice %> x <%= item.productCount %>\r\n                              </p>\r\n                          </div>\r\n            \r\n                        <!-- Delivery Status Section -->\r\n                        <div id=\"delivery-status-<%= order._id %>\" class=\"space-y-2\">\r\n                          <% if (item.status === 'Cancelled') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-red-500\"></span>\r\n                              <strong class=\"font-medium text-red-600\">Cancelled</strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your order has been cancelled.</p>\r\n                          <% } else if (item.status === 'Delivered') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-green-500\"></span>\r\n                              <strong class=\"font-medium text-green-600\">Delivered</strong>\r\n                              <span class=\"text-gray-600\">on <%= order.updatedAt.toLocaleDateString() %></span>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your item has been delivered.</p>\r\n                          <% } else if (item.status === 'Pending') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-yellow-500\"></span>\r\n                              <strong class=\"font-medium text-yellow-600\">Pending</strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your order is Pending.</p>\r\n                          <% }else if (item.status === 'Shipped') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-yellow-500\"></span>\r\n                              <strong class=\"font-medium text-yellow-600\">Shipped</strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your order is Shipped</p>\r\n                            <% }else if (item.status === 'Requested') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-violet-500\"></span>\r\n                              <strong class=\"font-medium text-violet-600\">Requested</strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your request has been sent.</p>\r\n                          <% } else if (item.status === 'Rejected') { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-gray-500\"></span>\r\n                              <strong class=\"font-medium text-gray-600\">Rejected</strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your request has been rejected.</p>\r\n                          <% } else { %>\r\n                            <div class=\"flex items-center gap-2\">\r\n                              <span class=\"w-2.5 h-2.5 rounded-full bg-blue-500\"></span>\r\n                              <strong class=\"font-medium text-blue-600\">Status: <%= item.status %></strong>\r\n                            </div>\r\n                            <p class=\"text-gray-600 text-sm\">Your order status is <%= item.status %>.</p>\r\n                          <% } %>\r\n                        </div>\r\n            \r\n                        <!-- Cancel and Return button -->\r\n                        <% if (item.status === 'Delivered') { %>\r\n                          <div class=\"flex flex-wrap gap-3 pt-4\">\r\n                            <button onclick=\"openModal('<%= order._id %>','<%= item.productId._id %>', 'return')\" \r\n                                    class=\"px-4 py-2 text-sm font-medium text-white bg-red-700 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-700 focus:ring-offset-2 transition-colors\">\r\n                              Return Order\r\n                            </button>\r\n                          </div>\r\n                        <% } else if (item.status !== 'Cancelled' && item.status !== 'Requested' && item.status !== 'Rejected') { %>\r\n                          <div class=\"flex flex-wrap gap-3 pt-4\">\r\n                            <button onclick=\"openModal('<%= order._id %>','<%= item.productId._id %>', 'cancel')\" \r\n                                    class=\"px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors\">\r\n                              Cancel Order\r\n                            </button>\r\n                          </div>\r\n                        <% } %>\r\n            \r\n                        <!-- Payment Retry (For Pending orders and failed payment) -->\r\n                        <% if (item.status === 'Pending' && ! order.paymentStatus) { %>\r\n                       \r\n                          <div class=\"flex flex-col items-center p-4 bg-red-100 rounded-lg shadow-lg space-y-4\">\r\n                            <p class=\"text-xl font-medium text-red-600\">Oops! Payment Failed</p>\r\n                            <p class=\"text-gray-700 text-center\">\r\n                              There was an issue with your payment. Please try again to complete your purchase.\r\n                            </p>\r\n                            <button \r\n                                type=\"button\" \r\n                                onclick=\"retryPayment('<%= order._id %>')\" \r\n                                class=\"px-6 py-3 bg-green-600 hover:bg-green-700 text-white text-sm font-semibold rounded-md transition duration-200 ease-in-out transform hover:scale-105 focus:ring-2 focus:ring-green-500 focus:outline-none\">\r\n                              Pay Now\r\n                            </button>\r\n                          </div>\r\n                        <% } %>\r\n                      </div>\r\n                    </div>\r\n                  <% } %> <!-- Check for valid item and productId -->\r\n                <% }) %>\r\n              </div>\r\n            <% } %> <!-- Check for valid order -->\r\n          <% }) %>\r\n          \r\n        \r\n     \r\n        <!-- Modal for Cancel and Return Action -->\r\n        <div id=\"cancelModal\" class=\"hidden fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50\">\r\n            <div class=\"bg-white rounded-lg w-1/3 p-6\">\r\n                <h2 class=\"text-lg font-semibold mb-4\" id=\"modalTitle\">Reason for Action</h2>\r\n                <form id=\"cancelForm\">\r\n                  <% orderDetails.forEach(order => { %>\r\n               \r\n                    <input type=\"hidden\" id=\"orderId\" name=\"orderId\" value=\"<%=order._id%>\">\r\n                    <input type=\"hidden\" id=\"actionType\" name=\"actionType\" value=\"\">\r\n                    <input type=\"hidden\" id=\"productId\" value=\"<%=order.items.productId %>\">\r\n                    <% }) %>\r\n                    <div class=\"mb-4\">\r\n                        <label for=\"reason\" class=\"block text-gray-700\">Enter Reason:</label>\r\n                        <textarea id=\"reason\" name=\"reason\" class=\"w-full p-2 border border-gray-300 rounded-md\" rows=\"3\" required></textarea>\r\n                    </div>\r\n                    \r\n                    <div class=\"flex justify-end gap-3\">\r\n                        <button type=\"button\" onclick=\"closeModal()\" class=\"px-4 py-2 bg-gray-500 text-white rounded-md\">Cancel</button>\r\n                        <button type=\"submit\" class=\"px-4 py-2 bg-red-600 text-white rounded-md\">Submit</button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n        \r\n    <div class=\"mt-4 flex justify-center space-x-4\">\r\n\r\n\r\n\r\n  <!-- Pagination -->\r\n\r\n\r\n  <!-- Previous Button -->\r\n  <% if (currentPage > 1) { %>\r\n    <a href=\"?page=<%= currentPage - 1 %>&limit=<%= limit %>\" \r\n       class=\"bg-gray-200 text-black px-4 py-2 rounded hover:bg-gray-300\">\r\n      Previous\r\n    </a>\r\n  <% } else { %>\r\n    <span class=\"bg-gray-200 text-gray-400 px-4 py-2 rounded cursor-not-allowed\">\r\n      Previous\r\n    </span>\r\n  <% } %>\r\n\r\n  <!-- Page Numbers -->\r\n  <% for (let i = 1; i <= totalPage; i++) { %>\r\n    <a href=\"?page=<%= i %>&limit=<%= limit %>\" \r\n       class=\"bg-gray-200 text-black px-4 py-2 rounded hover:bg-gray-300 <%= currentPage === i ? 'bg-gray-400' : '' %>\">\r\n      <%= i %>\r\n    </a>\r\n  <% } %>\r\n\r\n  <!-- Next Button -->\r\n  <% if (currentPage < totalPage) { %>\r\n    <a href=\"?page=<%= currentPage + 1 %>&limit=<%= limit %>\" \r\n       class=\"bg-gray-200 text-black px-4 py-2 rounded hover:bg-gray-300\">\r\n      Next\r\n    </a>\r\n  <% } else { %>\r\n    <span class=\"bg-gray-200 text-gray-400 px-4 py-2 rounded cursor-not-allowed\">\r\n      Next\r\n    </span>\r\n  <% } %>\r\n</div>\r\n\r\n        \r\n          <!-- No More Results Message -->\r\n          <div class=\"text-center py-8 border-t border-gray-100\">\r\n              <p class=\"text-gray-500 font-medium\">No More Results To Display</p>\r\n          </div>\r\n      </div>\r\n  </div>\r\n</div>\r\n<!-- Modal for Reason Input -->\r\n\r\n\r\n\r\n<!-- Modal -->\r\n\r\n<div id=\"modalBackground\" class=\"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity z-40 hidden\"></div>\r\n<div id=\"orderModal\" class=\"fixed inset-0 z-50 flex items-center justify-center p-4 hidden\">\r\n    <div class=\"relative w-full max-w-4xl bg-white rounded-xl shadow-2xl\">\r\n        <!-- Header -->\r\n        <h2 class=\"text-2xl font-semibold text-gray-900 p-6 border-b border-gray-200\">Order Details</h2>\r\n        \r\n        <!-- Main Content -->\r\n        <div class=\"p-6\">\r\n            <!-- Two Column Grid -->\r\n            <div class=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\r\n                <!-- Left Column -->\r\n                <div>\r\n                    <div class=\"mb-4\">\r\n                        <p class=\"font-medium text-gray-900\">Order ID: <span id=\"orderIds\" class=\"text-gray-700\"></span></p>\r\n                        <p class=\"font-medium text-gray-900\">Order Date: <span id=\"orderDate\" class=\"text-gray-700\"></span></p>\r\n                    </div>\r\n                    \r\n                    <div class=\"mt-6\">\r\n                        <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">Shipping Address</h3>\r\n                        <p id=\"shippingAddress\" class=\"text-gray-700\"></p>\r\n                    </div>\r\n                </div>\r\n                \r\n                <!-- Right Column -->\r\n                <div>\r\n                    <div class=\"mb-4\">\r\n                        <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">Payment Method</h3>\r\n                        <p id=\"paymentMethod\" class=\"text-gray-700\"></p>\r\n                    </div>\r\n                    <div class=\"mb-4\">\r\n                      <h3 class=\"text-lg font-semibold text-gray-900 mb-2\">Coupon discount</h3>\r\n                      <p id=\"couponApplied\" class=\"text-gray-700\"></p>\r\n                  </div> \r\n                </div>\r\n                <div>\r\n              </div>\r\n            </div>\r\n            \r\n            <!-- Items Table -->\r\n            <div class=\"mt-8\">\r\n                <h3 class=\"text-lg font-semibold text-gray-900 mb-4\">Items Purchased</h3>\r\n                <div class=\"overflow-x-auto\">\r\n                    <table class=\"w-full\">\r\n                        <thead>\r\n                            <tr class=\"bg-gray-50\">\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Product</th>\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Image</th>\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Quantity</th>\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Price</th>\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Discount</th>\r\n                                <th class=\"px-6 py-3 text-left text-sm font-medium text-gray-700\">Status</th>\r\n                               \r\n                              \r\n                            </tr>\r\n                        </thead>\r\n                        <tbody id=\"itemsPurchased\" class=\"divide-y divide-gray-200\">\r\n                            <!-- Items will be dynamically inserted here -->\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n            \r\n            <!-- Total Price -->\r\n            <div class=\"mt-6 flex justify-end\">\r\n                <p class=\"text-lg\">\r\n                    <span class=\"font-semibold text-gray-900\">Total Price:</span>\r\n                    <span class=\"ml-2\">₹<span id=\"totalPrice\" class=\"text-gray-900\"></span></span>\r\n                </p>\r\n            </div>\r\n            <button onclick=\"downloadOrderPDF()\" class=\"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors duration-200\">\r\n              Download Invoice as PDF\r\n          </button>\r\n            <!-- Close Button -->\r\n            <div class=\"mt-8 flex justify-end\">\r\n                <button onclick=\"closeModalOrderDetails()\" class=\"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors duration-200\">\r\n                    Close\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n\r\n<!-- Include SweetAlert2 Script -->\r\n<script src=\"https://checkout.razorpay.com/v1/checkout.js\"></script>\r\n<script src=\"https://cdn.jsdelivr.net/npm/sweetalert2@11\"></script>\r\n\r\n<script>\r\n\r\n  function viewOrder(orderId){    \r\n    document.getElementById('modalBackground').classList.remove('hidden');\r\n    document.getElementById('orderModal').classList.remove('hidden');\r\n\r\n    fetch(`/orders/${orderId}`)\r\n    .then(response => response.json())\r\n    .then(order => {\r\n  \r\n               // Populate basic order details\r\n               document.getElementById('orderIds').textContent =order.orderId\r\n            document.getElementById('orderDate').textContent = new Date(order.createdAt).toLocaleDateString();\r\n            document.getElementById('shippingAddress').textContent = order.address;\r\n    \r\n\r\n            document.getElementById('paymentMethod').textContent = order.paymentMethod;\r\n            document.getElementById('couponApplied').textContent = `₹Rs order.couponDiscount}`\r\n           document.getElementById('totalPrice').textContent = order.payableAmount.toLocaleString();\r\n\r\n            // Clear existing items\r\n            const itemsTable = document.getElementById('itemsPurchased');\r\n            itemsTable.innerHTML = '';\r\n\r\n            // Add items with status\r\n            order.items.forEach(item => {\r\n                const row = document.createElement('tr');\r\n                row.innerHTML = `\r\n    <tr class=\"hover:bg-gray-50 transition-colors\">\r\n    <!-- Product Name -->\r\n    <td class=\"px-6 py-4\">\r\n        <p class=\"text-sm text-gray-700 font-medium\">${item.productId.name}</p>\r\n    </td>\r\n    \r\n    <!-- Product Image -->\r\n    <td class=\"px-6 py-4\">\r\n        <img src=\"/uploads/${item.productImage}\" \r\n             alt=\"Product image\" \r\n             class=\"w-16 h-16 object-cover rounded-lg shadow-sm hover:shadow-md transition-shadow\">\r\n    </td>\r\n    \r\n    <!-- Product Count -->\r\n    <td class=\"px-6 py-4\">\r\n        <span class=\"text-sm text-gray-700\">${item.productCount}</span>\r\n    </td>\r\n    \r\n    <!-- Product Price -->\r\n    <td class=\"px-6 py-4\">\r\n        <span class=\"text-sm font-medium text-gray-900\">\r\n            ₹${item.productPrice} × ${item.productCount}\r\n        </span>\r\n    </td>\r\n    \r\n    <!-- Discount -->\r\n    <td class=\"px-6 py-4\">\r\n        <span class=\"text-sm font-medium text-green-600\">\r\n            ${item.productId.discount}%\r\n        </span>\r\n    </td>\r\n    \r\n    <!-- Status -->\r\n    <td class=\"px-6 py-4\">\r\n        <div class=\"flex flex-col gap-2\">\r\n            <span class=\"px-3 py-1 text-xs font-medium rounded-full inline-flex items-center justify-center ${getStatusClass(item.status)}\">\r\n                ${item.status}\r\n            </span>\r\n            <span class=\"text-xs text-gray-500\">\r\n                ${getStatusTimeline(item.status)}\r\n            </span>\r\n        </div>\r\n    </td>\r\n</tr>\r\n            \r\n                `;\r\n                itemsTable.appendChild(row);\r\n            });\r\n\r\n            // Add order status section\r\n            const orderStatusDiv = document.getElementById('orderStatus');\r\n            if (orderStatusDiv) {\r\n                orderStatusDiv.innerHTML = `\r\n                    <div class=\"flex items-center space-x-2\">\r\n                        <span class=\"px-3 py-1 text-xs font-medium rounded-full ${getStatusClass(order.status)}\">\r\n                            ${order.status}\r\n                        </span>\r\n                        ${order.isCancel ? \r\n                            '<span class=\"text-red-600 text-sm\">(Order Cancelled)</span>' \r\n                            : ''}\r\n                    </div>\r\n                `;\r\n            }\r\n    })\r\n  }\r\n  function getStatusClass(status) {\r\n    const statusClasses = {\r\n        'Pending': 'bg-yellow-100 text-yellow-800',\r\n        'Shipped': 'bg-blue-100 text-blue-800',\r\n        'Delivered': 'bg-purple-100 text-purple-800',\r\n        'Cancelled': 'bg-red-100 text-red-800',\r\n        'Returned': 'bg-gray-100 text-gray-800'\r\n    };\r\n    return statusClasses[status] || 'bg-gray-100 text-gray-800';\r\n}\r\n\r\nfunction getStatusTimeline(currentStatus) {\r\n    const statuses = ['Pending', 'Shipped', 'Delivered'];\r\n    const currentIndex = statuses.indexOf(currentStatus);\r\n    \r\n    if (currentStatus === 'Cancelled' || currentStatus === 'Returned') {\r\n        return ''; // Don't show timeline for cancelled/returned items\r\n    }\r\n\r\n    return `\r\n        <div class=\"mt-2\">\r\n            <div class=\"flex items-center space-x-2 text-xs\">\r\n                ${statuses.map((status, index) => `\r\n                    <span class=\"${index <= currentIndex ? 'text-blue-600' : 'text-gray-400'}\">\r\n                        ${status}\r\n                    </span>\r\n                    ${index < statuses.length - 1 ? `\r\n                        <span class=\"${index < currentIndex ? 'text-blue-600' : 'text-gray-300'}\">→</span>\r\n                    ` : ''}\r\n                `).join('')}\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n  function closeModalOrderDetails() {\r\n    document.getElementById('modalBackground').classList.add('hidden');\r\n    document.getElementById('orderModal').classList.add('hidden');\r\n}\r\n// When the Cancel Order button is clicked, open the modal and set the order ID\r\nfunction openModal(orderId, productId, action) {\r\n  console.log(`productId = ${productId}`)\r\n  console.log(`orderId = ${orderId}`)\r\n  console.log(`action = ${action}`)\r\n\r\n    document.getElementById('cancelModal').classList.remove('hidden');\r\n    document.getElementById('orderId').value = orderId;\r\n    document.getElementById('productId').value = productId; // Set productId\r\n    document.getElementById('actionType').value = action;\r\n    document.getElementById('modalTitle').innerText = `Reason for ${action.charAt(0).toUpperCase() + action.slice(1)} Order`;\r\n}\r\n\r\n  // Close Modal Function\r\n  function closeModal  () {\r\n    document.getElementById('cancelModal').classList.add('hidden');\r\n    document.getElementById('reason').value = '';\r\n  }\r\n\r\n// JavaScript for submitting the cancel/return form with reason\r\ndocument.getElementById('cancelForm').addEventListener('submit', function(e) {\r\n  e.preventDefault();\r\n  console.log('prevented')\r\n  const orderId = document.getElementById('orderId').value;\r\n  const productId = document.getElementById('productId').value;\r\n  const actionType = document.getElementById('actionType').value;\r\n  const reason = document.getElementById('reason').value;\r\n\r\n  fetch(`/cancelOrder/${orderId}`, {\r\n    method: 'POST',\r\n    headers: { 'Content-Type': 'application/json' },\r\n    body: JSON.stringify({ action: actionType, reason: reason ,productId:productId})\r\n  })\r\n  .then(response => response.json())\r\n  .then(data => {\r\n    Swal.fire({\r\n      icon: 'success',  // Change this to 'error' for error messages\r\n      title: 'Success',\r\n      text: data.message,  // Display success message from server\r\n      confirmButtonText: 'OK',\r\n    }).then(() => {\r\n      closeModal();  // Close the modal\r\n      // Optionally refresh the page or update the UI\r\n      location.reload(); // Uncomment this if you want to refresh the page\r\n    });\r\n  })\r\n  .catch(error => {\r\n    console.error('Error:', error);\r\n    Swal.fire({\r\n      icon: 'error',\r\n      title: 'Error',\r\n      text: 'An error occurred while processing your request.',\r\n      confirmButtonText: 'OK'\r\n    });\r\n  });\r\n});\r\n\r\n\r\nfunction showError(message) {\r\n  // You can customize this to show the error on the UI\r\n  alert(message);\r\n  console.error(message);\r\n}\r\n\r\nasync function downloadOrderPDF (){\r\ntry {\r\n  const orderId = document.getElementById('orderId').value\r\n  const response = await fetch(`/orders/dowload-pdf/${orderId}`,{\r\n    method:'GET',\r\n    headers:{\r\n      'Content-type':'application/json',\r\n    },\r\n  });\r\n\r\n  if(!response.ok) throw new Error('PDF generation failed')\r\n  const blob = await response.blob();\r\n        const downloadUrl = window.URL.createObjectURL(blob);\r\n        const link = document.createElement('a');\r\n        link.href = downloadUrl;\r\n        link.download = `order-${orderId}.pdf`;\r\n        document.body.appendChild(link);\r\n        link.click();\r\n        document.body.removeChild(link);\r\n        window.URL.revokeObjectURL(downloadUrl);\r\n} catch (error) {\r\n  console.log(`error dowloading PDf ${error}`)\r\n}\r\n}\r\n\r\n</script>\r\n\r\n<%- include('footer') %>"
        }
    ]
}