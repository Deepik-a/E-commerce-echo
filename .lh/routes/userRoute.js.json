{
    "sourceFile": "routes/userRoute.js",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 6,
            "patches": [
                {
                    "date": 1736720708589,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1736720714509,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -35,12 +35,10 @@\n \r\n /*-------------------------------------signup-----------------*/\r\n route.get('/signup',checkUser,userController.signup)\r\n route.post('/signup',checkUser,userController.signupPost)\r\n-\r\n route.get('/otp',checkUser,userController.otp)\r\n route.post('/otp',checkUser,userController.otppost)\r\n-\r\n route.get('/resend',checkUser,userController.otpResend)\r\n \r\n \r\n route.get('/login',checkUser,userController.login)\r\n"
                },
                {
                    "date": 1736720722273,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -38,15 +38,12 @@\n route.post('/signup',checkUser,userController.signupPost)\r\n route.get('/otp',checkUser,userController.otp)\r\n route.post('/otp',checkUser,userController.otppost)\r\n route.get('/resend',checkUser,userController.otpResend)\r\n-\r\n-\r\n route.get('/login',checkUser,userController.login)\r\n-\r\n route.post('/login',checkUser,userController.loginpost)\r\n+route.get('/logout',checkUser,userController.logout)\r\n \r\n-route.get('/logout',checkUser,userController.logout)\r\n //------------------------ login using google ------------------------\r\n \r\n \r\n // route.get('/auth/google/callback',userController.googleAuthCallback);\r\n"
                },
                {
                    "date": 1736720731845,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -42,8 +42,9 @@\n route.get('/login',checkUser,userController.login)\r\n route.post('/login',checkUser,userController.loginpost)\r\n route.get('/logout',checkUser,userController.logout)\r\n \r\n+\r\n //------------------------ login using google ------------------------\r\n \r\n \r\n // route.get('/auth/google/callback',userController.googleAuthCallback);\r\n@@ -113,22 +114,16 @@\n route.post('/cart/increment',checkUser ,cartController.increment);\r\n route.post('/cart/decrement',checkUser ,cartController.decrement);\r\n \r\n \r\n-// //---------------------------------- wishlist------------------------\r\n \r\n-// route.get('/wishlist',wishlistController.wishlistPage)\r\n \r\n \r\n \r\n-// //---------------------------------- Order  ------------------------\r\n \r\n \r\n \r\n \r\n-\r\n-\r\n-\r\n //------------------------------- Wishlist ---------------------------\r\n \r\n route.get('/wishlist', checkUser, wishlistController.wishlistpage );\r\n \r\n"
                },
                {
                    "date": 1736720737145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -115,21 +115,12 @@\n route.post('/cart/decrement',checkUser ,cartController.decrement);\r\n \r\n \r\n \r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n-\r\n //------------------------------- Wishlist ---------------------------\r\n \r\n route.get('/wishlist', checkUser, wishlistController.wishlistpage );\r\n-\r\n route.post('/add-wishlist/:id', checkUser, wishlistController.addWishlist );\r\n-\r\n route.post('/delete-wish/:id', checkUser , wishlistController.deleteWishlist );\r\n \r\n \r\n \r\n"
                },
                {
                    "date": 1736720742315,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,9 @@\n \r\n \r\n \r\n //---------------------------------- Category and main page------------------------\r\n-// route.get('/categories', checkUser ,categoryController.getAllCategories);\r\n+\r\n route.get('/product/:id', checkUser ,productController.getProductDetail)\r\n route.get('/all-products', checkUser ,productController.getAllProducts);\r\n route.get('/products',checkUser,productController.sortAllproducts)\r\n route.get('/categories/:categoryName',checkUser , productController.getProductsByCategory);\r\n"
                },
                {
                    "date": 1736720748983,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -124,9 +124,8 @@\n \r\n \r\n \r\n //---------------------------------- Category and main page------------------------\r\n-\r\n route.get('/product/:id', checkUser ,productController.getProductDetail)\r\n route.get('/all-products', checkUser ,productController.getAllProducts);\r\n route.get('/products',checkUser,productController.sortAllproducts)\r\n route.get('/categories/:categoryName',checkUser , productController.getProductsByCategory);\r\n@@ -155,8 +154,9 @@\n route.get('/failed-order',checkUser,checkOutController.failedOrder)\r\n route.post('/place-order/:address/:payment',checkOutController.placeOrder)\r\n route.get('/conform-order',checkUser,checkOutController.orderConformPage)\r\n route.get('/orders',orderController.orderPage)\r\n+\r\n //--------------------------------------Razorpay----------------------------------\r\n \r\n route.post('/payment-render/:amount',checkOutController.paymentRender)\r\n route.post('/retryRazorPay',orderController.retryRazorPay)\r\n"
                }
            ],
            "date": 1736720708588,
            "name": "Commit-0",
            "content": "const express=require('express')\r\nconst route=express.Router()\r\nconst passport = require('passport');\r\n\r\n\r\nconst activeUser = require('../middleware/userSession');\r\nconst checkUser= require('../middleware/checkUserSession');\r\nconst loadCategoriesMiddleware = require('../middleware/setCategoryinLocals')\r\n\r\n// load categories to navbar2\r\nroute.use(loadCategoriesMiddleware);\r\n\r\n\r\nconst userController=require(\"../controller/userController/userController\")\r\nconst User=require(\"../model/userSchema\")\r\nconst productController=require(\"../controller/userController/productController\")\r\nconst profileController=require('../controller/userController/profileController')\r\nconst cartController=require('../controller/userController/cartController')\r\nconst navbarController=require('../controller/userController/navbarcontroller')\r\nconst categorySchema=require('../model/categorySchema')\r\nconst productSchema=require('../model/productSchema')\r\nconst checkOutController=require('../controller/userController/checkoutcontroller')\r\nconst forgotPassword=require('../controller/userController/forgotPassword')\r\nconst walletController=require('../controller/userController/walletController')\r\nconst orderController=require('../controller/userController/orderController')\r\nconst wishlistController=require('../controller/userController/wishlistcontroller')\r\nconst pdfController = require('../controller/userController/pdfController')\r\n\r\n\r\n\r\n\r\n//-------------------------------- home -------------------------------\r\n\r\nroute.get('/' ,checkUser,navbarController.home);\r\n\r\n/*-------------------------------------signup-----------------*/\r\nroute.get('/signup',checkUser,userController.signup)\r\nroute.post('/signup',checkUser,userController.signupPost)\r\n\r\nroute.get('/otp',checkUser,userController.otp)\r\nroute.post('/otp',checkUser,userController.otppost)\r\n\r\nroute.get('/resend',checkUser,userController.otpResend)\r\n\r\n\r\nroute.get('/login',checkUser,userController.login)\r\n\r\nroute.post('/login',checkUser,userController.loginpost)\r\n\r\nroute.get('/logout',checkUser,userController.logout)\r\n//------------------------ login using google ------------------------\r\n\r\n\r\n// route.get('/auth/google/callback',userController.googleAuthCallback);\r\nroute.get('/auth/google', passport.authenticate('google', { scope: ['profile', 'email'] }));\r\n\r\n// Google OAuth callback route\r\n\r\nconst MongoServerError = require('mongodb').MongoServerError;\r\nroute.get('/auth/google/callback',\r\n  passport.authenticate('google', { failureRedirect: '/' }),\r\n  async (req, res) => {\r\n    try {\r\n      const categories = await categorySchema.find({ isDeleted: false });\r\n      const products = await productSchema.find({ isActive: true });\r\n\r\n      // Attempt to find an existing user by email\r\n      let user = await User.findOne({ email: req.user.email });\r\n\r\n      if (!user) {\r\n        // If user doesn't exist, create a new user\r\n        try {\r\n          user = await User.create({\r\n            email: req.user.email,\r\n            name: req.user.name,  // Assuming `name` is part of the Google profile\r\n          });\r\n        } catch (err) {\r\n        \r\n          // Handle duplicate key error\r\n          if ( err.code === E11000) {\r\n               // Duplicate email error: User already exists\r\n           console.log(`Duplicate email error: ${req.user.email}`)\r\n            // Pass the error message to the view explicitly\r\n            return res.render('user/login', { error: 'This email is already associated with an existing account. Please log in.' });\r\n          }\r\n            // If any other error occurs, throw the error\r\n            console.log(err);\r\n          throw err; // Throw other errors to be caught by the outer catch block\r\n        }\r\n      }\r\n\r\n      if (user.isBlocked) {\r\n        return res.render('user/signup', { message: 'Your account has been blocked' });\r\n      }\r\n\r\n      // Set session for the authenticated user\r\n      req.session.user = user._id;\r\n\r\n      // Render the landing page with user details\r\n      res.render('user/Landingpage', { categories, products, user });\r\n    } catch (error) {\r\n      console.error(`Error during Google OAuth callback: ${error.message}`);\r\n      res.redirect('/'); // Redirect to home on error\r\n    }\r\n  }\r\n);\r\n\r\n\r\n\r\n\r\n\r\n\r\n// //---------------------------------- Cart ------------------------\r\n\r\nroute.post('/cart/add/:id/:finalPrice',checkUser,cartController.addToCart);\r\nroute.get('/cart',checkUser, cartController.getCart);\r\nroute.get('/cart/remove/:id', checkUser ,cartController.removeFromCart);\r\nroute.post('/cart/increment',checkUser ,cartController.increment);\r\nroute.post('/cart/decrement',checkUser ,cartController.decrement);\r\n\r\n\r\n// //---------------------------------- wishlist------------------------\r\n\r\n// route.get('/wishlist',wishlistController.wishlistPage)\r\n\r\n\r\n\r\n// //---------------------------------- Order  ------------------------\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n//------------------------------- Wishlist ---------------------------\r\n\r\nroute.get('/wishlist', checkUser, wishlistController.wishlistpage );\r\n\r\nroute.post('/add-wishlist/:id', checkUser, wishlistController.addWishlist );\r\n\r\nroute.post('/delete-wish/:id', checkUser , wishlistController.deleteWishlist );\r\n\r\n\r\n\r\n//---------------------------------- Category and main page------------------------\r\n// route.get('/categories', checkUser ,categoryController.getAllCategories);\r\nroute.get('/product/:id', checkUser ,productController.getProductDetail)\r\nroute.get('/all-products', checkUser ,productController.getAllProducts);\r\nroute.get('/products',checkUser,productController.sortAllproducts)\r\nroute.get('/categories/:categoryName',checkUser , productController.getProductsByCategory);\r\nroute.post('/search',checkUser,productController.searchbyProducts)\r\n\r\n\r\n //--------------------------------UserProfile----------------------------\r\nroute.get('/userprofile',checkUser,profileController.profile)\r\nroute.post('/update-profile',  checkUser,profileController.updatedProfile);\r\nroute.post('/add-address',checkUser, profileController.addAddress);\r\nroute.post('/delete-address/:index',checkUser,profileController.removeAddress)\r\nroute.post('/edit-address/:index',checkUser,profileController.editAddress)\r\n\r\n\r\n\r\n//----------------------------- wallet route --------------------------\r\n\r\nroute.get('/wallet', checkUser, walletController.walletPage);\r\n\r\n\r\n\r\n\r\n//----------------------------- checkout --------------------------\r\nroute.get('/checkout',checkUser,checkOutController.getCheckoutPage); \r\nroute.get('/checkout/validate',checkUser,checkOutController.validateCheckout)\r\nroute.get('/failed-order',checkUser,checkOutController.failedOrder)\r\nroute.post('/place-order/:address/:payment',checkOutController.placeOrder)\r\nroute.get('/conform-order',checkUser,checkOutController.orderConformPage)\r\nroute.get('/orders',orderController.orderPage)\r\n//--------------------------------------Razorpay----------------------------------\r\n\r\nroute.post('/payment-render/:amount',checkOutController.paymentRender)\r\nroute.post('/retryRazorPay',orderController.retryRazorPay)\r\nroute.post('/retryPayment',orderController.retryPayment)\r\n\r\n//--------------------------------------Coupon----------------------------------\r\n\r\nroute.post('/applyCoupon',checkOutController.applyCoupon)\r\nroute.post('/removeCoupon',checkOutController.removeCoupon)\r\nroute.get('/coupons',checkUser,checkOutController.userCoupons)\r\n\r\n\r\n\r\n//----------------------------------order page-------------------\r\nroute.get('/orders/:id',orderController.viewOrderDetails)\r\nroute.get('/orders/dowload-pdf/:orderId',pdfController.generateOrderPDF)\r\nroute.post('/cancelOrder/:id',orderController.cancelOrder);\r\n\r\n\r\n//------------------------- forgot password ---------------------------\r\n\r\nroute.get('/forgotpassword' , forgotPassword.forgotPassword);\r\nroute.post('/forgotpassword' , forgotPassword.forgotPasswordPost);\r\nroute.get('/forgotpasswordotp' , forgotPassword.forgotPasswordOtp);\r\nroute.post('/forgotpasswordotp' , forgotPassword.forgotPasswordOtpPost);\r\nroute.post('/resetpassword' , forgotPassword.resetPasswordPost);\r\nroute.get('/forgotpassword-resend/:email' , forgotPassword.forgotResend);\r\n\r\nmodule.exports = route;"
        }
    ]
}